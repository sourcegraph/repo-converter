# See Docker Compose docs for why a separate override file is required
# https://docs.docker.com/compose/how-tos/multiple-compose-files/include/#include-and-overrides

services:

  repo-converter:
    build:
      context: ../
      dockerfile: build/Dockerfile
    image: sourcegraph/repo-converter:build
    volumes:
      - ../dev/toprc:/root/.config/procps/toprc # Add `top` config file
    environment:

      - LOG_LEVEL=DEBUG # DEBUG INFO WARNING ERROR CRITICAL # Default is INFO
      - REPO_CONVERTER_INTERVAL_SECONDS=60 # Default is 3600 seconds (1 hour)
      # - REPOS_TO_CONVERT="/sourcegraph/repos-to-convert.yaml" # Path inside the container to find this file, only change to match if the right side of the volume mapping changes
      # - SRC_SERVE_ROOT="/sourcegraph/src-serve-root" # Path inside the container to find this directory, only change to match if the right side of the volume mapping changes

      # Pass in build-time env vars, declared in ./build.sh
      - BUILD_BRANCH
      - BUILD_COMMIT
      - BUILD_DATE
      - BUILD_DIRTY
      - BUILD_TAG

  src-serve-git:
    container_name: src-serve-git-wsl.local # Override hostname
    command: "-v serve-git -addr :443 /sourcegraph/src-serve-root" # -v verbose output
    volumes:
      - ../src-serve-root/:/sourcegraph/src-serve-root:ro # Correct path
