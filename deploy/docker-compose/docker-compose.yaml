# Sane defaults, which will work as is
# Can create a docker-compose.override.yaml file to override any of these defaults

services:

  cloud-agent:
    container_name: cloud-agent
    image: index.docker.io/sourcegraph/src-tunnel-agent:latest@sha256:b95aaff78796a285aed2fc2a4594aff7b5dc96fd112218ba73e7eceb12149e98
    volumes:
      - ../../config/cloud-agent-service-account-key.json:/sourcegraph/cloud-agent-service-account-key.json:ro
      - ../../config/cloud-agent-config.yaml:/sourcegraph/cloud-agent-config.yaml:ro
    command: ["-config=/sourcegraph/cloud-agent-config.yaml"]
    restart: always
    networks:
      - default

  repo-converter:
    container_name: repo-converter
    image: ghcr.io/sourcegraph/repo-converter:latest@sha256:0232dc8da3a371818eef3731339f48832d90b209af7d6660034565152b068034
    volumes:
      - ../../config/repos-to-convert.yaml:/sourcegraph/repos-to-convert.yaml:ro
      - ../../src-serve-root/:/sourcegraph/src-serve-root
    restart: always
    # environment:
      # - REPO_CONVERTER_INTERVAL_SECONDS=60 # Default is 3600 seconds (1 hour)
      # - LOG_LEVEL=DEBUG # DEBUG INFO WARNING ERROR CRITICAL # Default is INFO

  src-serve-git:
    # Uses a valid hostname as container_name, to trick the cloud agent and code host config into finding this container on the Docker network
    container_name: src-serve-git.local
    image:  index.docker.io/sourcegraph/src-cli:latest@sha256:190c0e75ae0331ab12d9543bae9ec20e38dbaad3dcdffa904412dad62f0e845e
    volumes:
      - ../../src-serve-root/:/sourcegraph/src-serve-root:ro
    command: "serve-git -addr :443 /sourcegraph/src-serve-root"
    restart: always
    networks:
      - default

networks:
  default:
